{"ast":null,"code":"import * as THREE from 'three';\nexport class MeshIsolation {\n  show(objectUuids, opacity = 0.2, duration = 0.2) {\n    this.saveTransparency(); //fade out last action if exists\n\n    this.end(); //fade in new action\n\n    const clip = MeshIsolation.createAnumationClip(objectUuids, opacity);\n    this.action = Q3.mixer.clipAction(clip);\n    this.action.play();\n    this.action.fadeDuration = duration;\n    this.action.fadeIn(duration);\n  }\n\n  end() {\n    if (this.action) {\n      this.action.fadeOut(this.action.fadeDuration);\n      const _action = this.action;\n      setTimeout(() => {\n        _action.stop();\n\n        if (!this.action) {\n          this.recoverTransparency();\n        }\n      }, this.action.fadeDuration * 1000);\n      this.action = null;\n    }\n  }\n\n  static createAnumationClip(objectUuids, opacity) {\n    const tracks = [];\n\n    for (var uuid in Q3.assets.objects) {\n      if (Q3.assets.objects.hasOwnProperty(uuid) && objectUuids.indexOf(uuid) === -1) {\n        const object = Q3.assets.objects[uuid];\n\n        if (object instanceof THREE.Mesh) {\n          tracks.push(MeshIsolation.createMeshOpacityTrack(uuid, opacity)); //tracks.push( new THREE.BooleanKeyframeTrack(uuid + \".material.transparent\", [0], [true], THREE.InterpolateDiscrete));\n        }\n      }\n    }\n\n    return new THREE.AnimationClip('isolation sequence', -1, tracks);\n  }\n\n  static createMeshOpacityTrack(meshUuid, opacity) {\n    const times = new Float32Array(2);\n    const values = new Float32Array(2);\n    times[0] = 0;\n    times[1] = 1;\n    values[0] = opacity;\n    values[1] = opacity;\n    const track = new THREE.NumberKeyframeTrack(meshUuid + '.material.opacity', times, values);\n    return track;\n  }\n\n  saveTransparency() {\n    if (!this.transparencies) {\n      this.transparencies = {};\n\n      for (var uuid in Q3.assets.objects) {\n        const object = Q3.assets.objects[uuid];\n\n        if (object instanceof THREE.Mesh) {\n          this.transparencies[uuid] = object.material.transparent;\n          object.material.transparent = true;\n        }\n      }\n    }\n  }\n\n  recoverTransparency() {\n    if (this.transparencies) {\n      for (var uuid in this.transparencies) {\n        const object = Q3.assets.objects[uuid];\n\n        if (object && object instanceof THREE.Mesh) {\n          object.material.transparent = this.transparencies[uuid];\n        }\n      }\n\n      this.transparencies = null;\n    }\n  }\n\n} // WEBPACK FOOTER //\n// ./src/Q3/animations/meshIsolation.js","map":{"version":3,"sources":["/Users/ghost/Documents/three/src/source/animations/meshIsolation.js"],"names":["THREE","MeshIsolation","show","objectUuids","opacity","duration","saveTransparency","end","clip","createAnumationClip","action","Q3","mixer","clipAction","play","fadeDuration","fadeIn","fadeOut","_action","setTimeout","stop","recoverTransparency","tracks","uuid","assets","objects","hasOwnProperty","indexOf","object","Mesh","push","createMeshOpacityTrack","AnimationClip","meshUuid","times","Float32Array","values","track","NumberKeyframeTrack","transparencies","material","transparent"],"mappings":"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","sourcesContent":["import * as THREE from 'three';\n\nexport class MeshIsolation {\n\tshow(objectUuids, opacity = 0.2, duration = 0.2) {\n\t\tthis.saveTransparency();\n\n\t\t//fade out last action if exists\n\t\tthis.end();\n\n\t\t//fade in new action\n\t\tconst clip = MeshIsolation.createAnumationClip(objectUuids, opacity);\n\t\tthis.action = Q3.mixer.clipAction(clip);\n\t\tthis.action.play();\n\t\tthis.action.fadeDuration = duration;\n\t\tthis.action.fadeIn(duration);\n\t}\n\n\tend() {\n\t\tif (this.action) {\n\t\t\tthis.action.fadeOut(this.action.fadeDuration);\n\t\t\tconst _action = this.action;\n\t\t\tsetTimeout(() => {\n\t\t\t\t_action.stop();\n\t\t\t\tif (!this.action) {\n\t\t\t\t\tthis.recoverTransparency();\n\t\t\t\t}\n\t\t\t}, this.action.fadeDuration * 1000);\n\t\t\tthis.action = null;\n\t\t}\n\t}\n\n\tstatic createAnumationClip(objectUuids, opacity) {\n\t\tconst tracks = [];\n\t\tfor (var uuid in Q3.assets.objects) {\n\t\t\tif (Q3.assets.objects.hasOwnProperty(uuid) && objectUuids.indexOf(uuid) === -1) {\n\t\t\t\tconst object = Q3.assets.objects[uuid];\n\t\t\t\tif (object instanceof THREE.Mesh) {\n\t\t\t\t\ttracks.push(MeshIsolation.createMeshOpacityTrack(uuid, opacity));\n\t\t\t\t\t//tracks.push( new THREE.BooleanKeyframeTrack(uuid + \".material.transparent\", [0], [true], THREE.InterpolateDiscrete));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn new THREE.AnimationClip('isolation sequence', -1, tracks);\n\t}\n\n\tstatic createMeshOpacityTrack(meshUuid, opacity) {\n\t\tconst times = new Float32Array(2);\n\t\tconst values = new Float32Array(2);\n\t\ttimes[0] = 0;\n\t\ttimes[1] = 1;\n\t\tvalues[0] = opacity;\n\t\tvalues[1] = opacity;\n\t\tconst track = new THREE.NumberKeyframeTrack(meshUuid + '.material.opacity', times, values);\n\t\treturn track;\n\t}\n\n\tsaveTransparency() {\n\t\tif (!this.transparencies) {\n\t\t\tthis.transparencies = {};\n\t\t\tfor (var uuid in Q3.assets.objects) {\n\t\t\t\tconst object = Q3.assets.objects[uuid];\n\t\t\t\tif (object instanceof THREE.Mesh) {\n\t\t\t\t\tthis.transparencies[uuid] = object.material.transparent;\n\t\t\t\t\tobject.material.transparent = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\trecoverTransparency() {\n\t\tif (this.transparencies) {\n\t\t\tfor (var uuid in this.transparencies) {\n\t\t\t\tconst object = Q3.assets.objects[uuid];\n\t\t\t\tif (object && object instanceof THREE.Mesh) {\n\t\t\t\t\tobject.material.transparent = this.transparencies[uuid];\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.transparencies = null;\n\t\t}\n\t}\n}\n\n// WEBPACK FOOTER //\n// ./src/Q3/animations/meshIsolation.js\n"]},"metadata":{},"sourceType":"module"}